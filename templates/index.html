<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MotoPower - Tienda de Motos</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}">
  <style>
    /* Estilos b√°sicos para las nuevas secciones (puedes moverlos a estilos.css) */
    .login, .contacto {
        max-width: 400px;
        margin: 40px auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .login h2, .contacto h2 {
        text-align: center;
        color: #f39c12;
    }
    .login button, .contacto button {
        background-color: #f39c12;
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        width: 100%;
        margin-top: 15px;
    }
    /* Estilos generales (asumiendo que 'estilos.css' existe) */
    .logo { display: flex; align-items: center; }
    .logo img { width: 50px; margin-right: 10px; }
    .slides { display: flex; transition: transform 0.5s ease-in-out; }
    .slides img { width: 100%; flex-shrink: 0; }
  </style>
</head>
<body>

<header>
    <div class="logo">
         <img src="https://static.vecteezy.com/system/resources/thumbnails/026/972/734/small/black-motorcycle-club-logo-isolated-png.png"width="200" height="80" alt="Logo MotoPower">
      <h1>MotoPower</h1>
    </div>
    <p>Velocidad, potencia y estilo sobre dos ruedas </p>
   
    <button class="btn-carrito" onclick="toggleCarrito()">
  üõí Carrito (<span id="contador-carrito">0</span>)
</button>

</header>

  <nav class="botones">
    <button onclick="window.location.href='#catalogo'">Cat√°logo</button>
    <button onclick="window.location.href='#servicios'">Servicios</button>
    <button onclick="window.location.href='#inventario'">Inventario</button>
    <button onclick="window.location.href='#contacto'">Contacto</button>
    <div class="auth-container">
  <button id="btn-auth" type="button">
    <span id="auth-icon">üîê</span>
    <span id="auth-text">Iniciar sesi√≥n</span>
  </button>

  <div id="profile-menu" class="profile-menu">
    <div class="profile-item">üë§ Perfil</div>
    <div class="profile-item" id="logout-btn">üö™ Cerrar sesi√≥n</div>
  </div>
</div>

  </nav>
  
<div id="auth-modal">
  <div class="auth-panel">
    <div class="close" id="close-auth">‚úñ</div>

    <!-- LOGIN -->
    <div id="login-panel">
      <h2>Iniciar sesi√≥n</h2>
      <input type="email" id="login-email">
      <input type="password" id="login-password">
      <button id="login-btn">Entrar</button>
      <p id="login-feedback"></p>
      <div class="switch" id="go-register">¬øNo tienes cuenta? Reg√≠strate</div>
    </div>

    <!-- REGISTRO -->
    <div id="register-panel" style="display:none;">
      <h2>Registrarse</h2>
      <input type="email" id="register-email">
      <input type="password" id="register-password">
      <button id="register-btn">Crear cuenta</button>
      <p id="register-feedback"></p>
      <div class="switch" id="go-login">¬øYa tienes cuenta? Inicia sesi√≥n</div>
    </div>

  </div>
</div>


  <section class="carrusel">
    <div class="slides">
     <img src="https://dhqlmcogwd1an.cloudfront.net/images/phocagallery/yamaha/yzf-r15/01-yamaha-yzf-r15-2022-estudio-azul-620.jpg" alt="Yamaha">

      <img src="https://www.honda.mx/web/img/motorcycles/models/naked/cb650r/gallery/1.jpg" alt="Honda">
      <img src="https://images.squarespace-cdn.com/content/v1/639bda5c64492137de0500b9/1671321053359-UM5XS07LCXP787EFH84H/1e0d7bb4-af05-44ac-bdaa-e986ce460e9e.jpg?format=1000w" alt="Kawasaki Z900">
    </div>
  </section>

  <section id="catalogo" class="catalogo">
    <h2>Cat√°logo de Motos</h2>
    <div class="productos">
      <div class="tarjeta">
        <img src="https://www.motorbikemag.es/wp-content/uploads/2024/10/Kawasaki-Z900-2025-estaticas3.jpg"width="800" height="200" alt="Z900">
        <h3>Kawasaki Z900</h3>
        <p>Motor de 948cc, 123 HP. Ideal para los amantes de la potencia.</p>
        <button onclick="alert('Agregada al carrito')">üõí Comprar</button>
      </div>
      <div class="tarjeta">
        <img src="https://cdn.shopify.com/s/files/1/0066/0334/1924/files/moto-honda-CB650R-1_1024x1024.webp?v=1712321399"width="800" height="200" alt="CB650R">
        <h3>Honda CB650R</h3>
        <p>Motor 649cc, dise√±o naked agresivo y rendimiento confiable.</p>
        <button onclick="alert('Agregada al carrito')">üõí Comprar</button>
      </div>
      <div class="tarjeta">
        <img src="https://autoshowtv.com.mx/wp-content/uploads/2024/11/YZF-R15-V4.jpg"width="800" height="200" alt="R15 V4">
        <h3>Yamaha R15 V4</h3>
        <p>Motor 155cc, ideal para ciudad con estilo deportivo.</p>
        <button onclick="alert('Agregada al carrito')">üõí Comprar</button>
      </div>
    </div>
  </section>

  <section id="servicios" class="servicios">
    <h2>Servicios disponibles</h2>
    <ul>
      <li>üîß Mantenimiento preventivo y correctivo</li>
      <li>üß¢ Venta de accesorios y equipo de protecci√≥n</li>
      <li>üí≥ Financiamiento flexible y seguros</li>
      <li>üöö Env√≠os a todo M√©xico</li>
    </ul>
  </section>
  
 
  <section id="inventario" class="inventario">
    <h2>Inventario Actual (Requiere Login)</h2>
    <table>
      <thead>
        <tr>
          <th>Modelo</th>
          <th>Marca</th>
          <th>Cilindraje</th>
          <th>Disponibles</th>
          <th>Precio</th>
        </tr>
      </thead>
      <tbody id="inventario-body">
        <tr><td colspan="5">Inicia sesi√≥n para ver el inventario.</td></tr>
      </tbody>
    </table>
  </section>

<section id="admin-form" class="inventario" style="display:none;">
  <h2 id="form-title">Agregar Moto</h2>

  <input type="hidden" id="moto-id">

  <label>Modelo</label>
  <input id="modelo">

  <label>Marca</label>
  <input id="marca">

  <label>Cilindraje</label>
  <input id="cilindraje">

  <label>Disponibles</label>
  <input id="disponibles" type="number">

  <label>Precio</label>
  <input id="precio" type="number">

  <button id="guardar-moto">Guardar</button>
  <button id="cancelar-edicion" style="display:none;">Cancelar</button>
</section>


  <section id="contacto" class="contacto">
    <h2>Cont√°ctanos</h2>
    <form id="formulario-contacto"> 
      <label for="nombre">Nombre:</label>
      <input type="text" id="nombre" required>

      <label for="correo">Correo electr√≥nico:</label>
      <input type="email" id="correo" required>

      <label for="mensaje">Mensaje:</label>
      <textarea id="mensaje" rows="4" required></textarea>

      <button type="submit">Enviar mensaje</button>
      <p id="mensaje-feedback" style="margin-top: 10px;"></p>
    </form>
  </section>

<footer>
    <p>&copy; 2025 MotoPower - Todos los derechos reservados</p>
    <p>S√≠guenos en:
      <a href="https://www.facebook.com/profile.php?id=61584828976426&rdid=XLlsZRvk7vxRDMHQ&share_url=https%3A%2F%2Fwww.facebook.com%2Fshare%2F1NkGCsdMcc%2F#" target="_blank">Facebook</a> |
      <a href="https://www.instagram.com/motp.ower?igsh=dTAwdm45aTRsNnBx" target="_blank">Instagram</a>
    </p>
</footer>

  <script type="module">
    
    // URL DE RENDER APLICADA para el backend
    const API_BASE_URL = "https://motoschingonas.onrender.com/api"; 

    
    // ----------------------------------------------------------------------
    // FUNCIONES DE LOGIN Y REGISTRO
    // ----------------------------------------------------------------------

    function verificarEstadoLogin() {
  const token = localStorage.getItem('userToken');

  if (token) {
    cargarInventario();
    actualizarEstadoUI();
  }
}


    async function manejarRegistro(event) {
        event.preventDefault();

        const url = `${API_BASE_URL}/register`;
        const feedback = document.getElementById('register-feedback');
        
        const datosRegistro = {
            email: document.getElementById('register-email').value,
            password: document.getElementById('register-password').value,
        };

        feedback.textContent = 'Registrando...';
        feedback.style.color = 'gray';

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datosRegistro)
            });

            const resultado = await response.json();
            
            feedback.textContent = resultado.mensaje;
            feedback.style.color = response.ok ? 'green' : 'red';
            
            if (response.ok) {
                document.getElementById('formulario-registro').reset();
            }

        } catch (error) {
            console.error('Error de conexi√≥n al intentar registrar:', error);
            feedback.textContent = 'Error de conexi√≥n con el servidor.';
            feedback.style.color = 'red';
        }
    }

    async function manejarLogin(event) {
        event.preventDefault(); 
        
        const url = `${API_BASE_URL}/login`;
        const feedback = document.getElementById('login-feedback');
        
        const datosLogin = {
            email: document.getElementById('login-email').value,
            password: document.getElementById('login-password').value,
        };

        feedback.textContent = 'Verificando...';
        feedback.style.color = 'gray';

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datosLogin)
            });

            const resultado = await response.json();
            
            if (response.ok) {
                // √âXITO
                feedback.textContent = `¬°Bienvenido, ${resultado.usuario}!`;
                feedback.style.color = 'green';
                
                localStorage.setItem('userToken', resultado.token);
                localStorage.setItem('userRole', resultado.role);

                verificarEstadoLogin();
                actualizarEstadoUI();
                document.getElementById('auth-modal').classList.remove('active');


            } else {
                // FALLO
                feedback.textContent = resultado.mensaje;
                feedback.style.color = 'red';
            }

        } catch (error) {
            console.error('Error de conexi√≥n al intentar iniciar sesi√≥n:', error);
            feedback.textContent = 'Error de conexi√≥n con el servidor.';
            feedback.style.color = 'red';
        }
    }
    
    // ----------------------------------------------------------------------
    // FUNCIONES DE INVENTARIO Y CONTACTO
    // ----------------------------------------------------------------------

    async function cargarInventario() {
  const token = localStorage.getItem('userToken');
  const role = localStorage.getItem('userRole');
  const tablaBody = document.getElementById('inventario-body');

  if (!token || role !== 'admin') {
    tablaBody.innerHTML = `<tr><td colspan="5">Acceso restringido</td></tr>`;
    return;
  }

  const url = `${API_BASE_URL}/inventario`;

  try {
    const response = await fetch(url, {
      headers: {
        "Authorization": `Bearer ${token}`,
        "X-User-Role": role
      }
    });

    if (!response.ok) {
      tablaBody.innerHTML = `<tr><td colspan="5">Acceso denegado</td></tr>`;
      return;
    }

    const inventario = await response.json();
    tablaBody.innerHTML = '';

    inventario.forEach(moto => {
      const row = tablaBody.insertRow();
      row.insertCell(0).textContent = moto.modelo;
      row.insertCell(1).textContent = moto.marca;
      row.insertCell(2).textContent = moto.cilindraje;
      row.insertCell(3).textContent = moto.disponibles;
      row.insertCell(4).textContent =
        new Intl.NumberFormat('es-MX', {
          style: 'currency',
          currency: 'MXN'
        }).format(moto.precio);
    });

  } catch (error) {
    console.error(error);
    tablaBody.innerHTML = `<tr><td colspan="5">Error del servidor</td></tr>`;
  }
}

    
    async function enviarFormularioContacto(event) {
        event.preventDefault(); 

        const url = `${API_BASE_URL}/contacto`;
        const feedback = document.getElementById('mensaje-feedback');
        
        const datos = {
            nombre: document.getElementById('nombre').value,
            correo: document.getElementById('correo').value,
            mensaje: document.getElementById('mensaje').value,
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datos)
            });

            const resultado = await response.json();
            
            feedback.textContent = resultado.mensaje;
            feedback.style.color = response.ok ? 'green' : 'red';

            if (response.ok) {
                document.getElementById('formulario-contacto').reset(); 
            }

        } catch (error) {
            console.error('Error al enviar formulario:', error);
            feedback.textContent = 'Hubo un error de conexi√≥n con el servidor.';
            feedback.style.color = 'red';
        }
    }

   function actualizarEstadoUI() {
  const token = localStorage.getItem('userToken');
  const role = localStorage.getItem('userRole');

  const authIcon = document.getElementById('auth-icon');
  const authText = document.getElementById('auth-text');
  const inventario = document.getElementById('inventario');
  const adminForm = document.getElementById('admin-form');
  const profileMenu = document.getElementById('profile-menu');
  const botonCarrito = document.getElementById('btn-carrito');

  if (token && role === 'admin') {
    authIcon.textContent = 'üë§';
    authText.textContent = 'Admin';
    inventario.style.display = 'block';
  } else {
    authIcon.textContent = 'üîê';
    authText.textContent = 'Iniciar sesi√≥n';
    inventario.style.display = 'none';
    profileMenu.style.display = 'none';
  }
}




  document.getElementById('logout-btn').onclick = () => {
  localStorage.removeItem('userToken');
  actualizarEstadoUI();
};


    // ----------------------------------------------------------------------
    // EJECUCI√ìN AL CARGAR EL DOCUMENTO
    // ----------------------------------------------------------------------

    document.addEventListener('DOMContentLoaded', () => {
  
  verificarEstadoLogin(); 
  actualizarEstadoUI();


  // BOTONES DEL MODAL
  document.getElementById('login-btn').addEventListener('click', manejarLogin);
  document.getElementById('register-btn').addEventListener('click', manejarRegistro);

  // FORMULARIO DE CONTACTO (ESTE S√ç EXISTE)
  document.getElementById('formulario-contacto')
    .addEventListener('submit', enviarFormularioContacto);

  // MODAL
  const authModal = document.getElementById('auth-modal');

  document.getElementById('btn-auth').onclick = () => {
  const token = localStorage.getItem('userToken');

  if (!token) {
    // NO hay sesi√≥n ‚Üí abrir login
    authModal.classList.add('active');
  } else {
    // S√ç hay sesi√≥n ‚Üí abrir men√∫ de perfil
    toggleProfileMenu();
  }
};

function toggleProfileMenu() {
  const menu = document.getElementById('profile-menu');
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

  document.getElementById('close-auth').onclick = () => {
    authModal.classList.remove('active');
  };

  document.getElementById('go-register').onclick = () => {
    document.getElementById('login-panel').style.display = 'none';
    document.getElementById('register-panel').style.display = 'block';
  };

  document.getElementById('go-login').onclick = () => {
    document.getElementById('register-panel').style.display = 'none';
    document.getElementById('login-panel').style.display = 'block';
  };
});


    // Script carrusel
    let index = 0;
    const slides = document.querySelector('.slides');
    const total = slides.children.length;

    setInterval(() => {
      index = (index + 1) % total;
      if (slides) { 
          slides.style.transform = `translateX(-${index * 100}%)`;
      }
    }, 3000);
function actualizarBotonAuth() {
  const token = localStorage.getItem('userToken');
  

  const icon = document.getElementById('auth-icon');
  const text = document.getElementById('auth-text');
//comentario
  if (token ) {
    icon.textContent = 'üë§';
    text.textContent = `Bienvenido`;
  } else {
    icon.textContent = 'üîê';
    text.textContent = 'Iniciar sesi√≥n';
  }
}

let carrito = [];

function toggleCarrito() {
  const panel = document.getElementById("carrito-panel");
  panel.style.display = panel.style.display === "block" ? "none" : "block";
}

function agregarAlCarrito(modelo, precio, imagen) {
  carrito.push({
    modelo: modelo,
    precio: precio,
    imagen: imagen
  });

  actualizarCarrito();
}



function actualizarCarrito() {
  const lista = document.getElementById("lista-carrito");
  const totalTexto = document.getElementById("total-carrito");
  const contador = document.getElementById("contador-carrito");

  lista.innerHTML = "";
  let total = 0;

  carrito.forEach(item => {
    const li = document.createElement("li");
li.style.display = "flex";
li.style.alignItems = "center";
li.style.marginBottom = "10px";

const img = document.createElement("img");
img.src = item.imagen;
img.style.width = "60px";
img.style.borderRadius = "6px";
img.style.marginRight = "10px";

const texto = document.createElement("span");
texto.textContent = `${item.modelo} - $${item.precio.toLocaleString()}`;

li.appendChild(img);
li.appendChild(texto);
lista.appendChild(li);

    total += item.precio;
  });

  contador.textContent = carrito.length;
  totalTexto.textContent = `Total: $${total.toLocaleString()}`;
}

function vaciarCarrito() {
  carrito = [];
  actualizarCarrito();
}

document.addEventListener('click', function (event) {
  const carritoPanel = document.getElementById('carrito-panel');
  const botonCarrito = document.querySelector('.btn-carrito');

  // Si el carrito NO est√° abierto, no hacemos nada
  if (carritoPanel.style.display !== 'block') return;

  // Si el click fue dentro del carrito, NO cerrar
  if (carritoPanel.contains(event.target)) return;

  // Si el click fue en el bot√≥n carrito, NO cerrar
  if (botonCarrito.contains(event.target)) return;

  // Si fue fuera ‚Üí cerrar carrito
  carritoPanel.style.display = 'none';
});



</script>

</body>
</html>
 
